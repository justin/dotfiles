{{ if lookPath "fzf" }}

# Always use a tmux popup for fzf
export FZF_TMUX_OPTS="-p"

# Use fzf to search through the fd-results via fd (https://github.com/sharkdp/fd) to include hidden
# files (but exclude .git folders) and respect .gitignore
# See more: https://github.com/junegunn/fzf/blob/master/ADVANCED.md
export FZF_DEFAULT_COMMAND="fd --type f --hidden --strip-cwd-prefix --exclude .git"

# CTRL-T − Paste the selected files onto the command-line.
export FZF_CTRL_T_COMMAND=$FZF_DEFAULT_COMMAND
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"

# ALT-C − cd into the selected directory.
# Preview file content using bat (https://github.com/sharkdp/bat)
export FZF_CTRL_T_OPTS="--preview 'bat -n --color=always {}'"

# ALT-C − cd into the selected directory.
# Print tree structure in the preview window
export FZF_ALT_C_OPTS="--preview 'eza --tree --color=always {}'"
export FZF_ALT_C_COMMAND="fd \
--type=d \
--hidden \
--strip-cwd-prefix \
--exclude .git"

# CTRL-R − Paste the selected command from history onto the command-line.
# CTRL-/ to toggle small preview window to see the full command
# CTRL-Y to copy the command into clipboard using pbcopy
export FZF_CTRL_R_OPTS="
  --preview 'echo {}' --preview-window down:3:hidden:wrap
  --bind 'ctrl-/:toggle-preview'
  --bind 'ctrl-y:execute-silent(echo -n {2..} | pbcopy)+abort'
  --color header:italic
  --header 'Press CTRL-Y to copy command into clipboard'"

fzf-history-widget-accept() {
  fzf-history-widget
  zle accept-line
}

# Bind executing the selected command to Ctrl+X Ctrl+R
zle     -N     fzf-history-widget-accept
bindkey '^X^R' fzf-history-widget-accept

########################################
# Theme
########################################
readonly FG="#FFFFFF"
readonly BG="#000000"
readonly BG_HIGHLIGHT="#222121"
readonly MAGENTA="#D31895"
readonly GREEN="#41CC45"
readonly YELLOW="#EFB759"
readonly CYAN="#4164FF"
readonly RED="#FF2B38"
readonly BLUE="#00A0FF"
readonly WHITE="#FFFFFF"

export FZF_COLORS="--color=fg:${FG}, \
bg:${BG}, \
hl:${MAGENTA}, \
fg+:${FG}, \
bg+:${BG_HIGHLIGHT}, \
hl+:${GREEN}, \
info:${YELLOW}, \
prompt:${CYAN}, \
pointer:${CYAN}, \
marker:${CYAN}, \
spinner:${CYAN}, \
header:${CYAN}"

export FZF_DEFAULT_OPTS="--height 60% \
--border rounded \
--layout reverse \
--color '$FZF_COLORS' \
--prompt '∷ ' \
--pointer ▶ \
--marker '✔ ' \
--bind='ctrl-o:execute(code {})+abort' \
--bind 'ctrl-/:change-preview-window(hidden|)' \
--preview-window='border-rounded' \
--info right"

# Set up fzf key bindings and fuzzy completion
eval "$(fzf --zsh)"

{{ end }}


