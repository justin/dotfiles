# .zshrc is for interactive shells.

# You set options for the interactive shell there with the setopt and unsetopt commands.
#
# Shut up and don't beep on error
setopt no_beep
# Offer to fix spelling fuckups for commands
setopt correct
# Offer to fix spelling fuckups for arguments
setopt correct_all
# Super GLOB
# https://zsh.sourceforge.io/Doc/Release/Expansion.html#Filename-Generation
setopt extended_glob
# zmv support
autoload -U zmv

{{ if eq .osid "darwin" }}
# Ensure we explicitly set all homebrew related environment variables.
eval "$({{ .homebrew.prefix }}/bin/brew shellenv)"
{{ end }}

# ===== Customize $fignore =====
fignore=(
  .DS_Store
  $fignore
)

# JWW: 09/24/23
# Because of how macOS uses path_helper for setting the PATH it's best to set
# the path values entirely up front instead of in each config file. This will
# allow things to be properly ordered.
#
# It shouldn't have any negative effect on Linux.
# https://0xmachos.com/2021-05-13-zsh-path-macos/

# ==== Customize $FPATH =====
# Prevent duplicates within search paths
typeset -U fpath
# Make user functions available
fpath=(
  $ZDOTDIR/functions
  {{ .homebrew.prefix }}/share/zsh/site-functions(N)
  $fpath
)

# ===== Customize $PATH =====
# U for Unique, like a set;
# (N) == only if exists
typeset -U path   # Prevent duplicates within search paths
path=(
  $HOME/.local/bin
  {{- if eq .osid "darwin" }}
  $HOME/.local/bin/darwin
  {{ else if eq .osid "linux-ubuntu" }}
  $HOME/.local/bin/ubuntu(N)
  {{ end }}
  $XDG_DATA_HOME/cargo/bin(N)
  $path
)

{{ if eq .osid "darwin" }}
# New in 3.0.0. Use the Bootsnap gem if available to build and update.
# https://github.com/Homebrew/brew/pull/10374
export HOMEBREW_BOOTSNAP=1
export HOMEBREW_EDITOR=$EDITOR
export HOMEBREW_BUNDLE_FILE="$XDG_CONFIG_HOME/homebrew/Brewfile"
{{- end }}

{{ if and (not .ephemeral) (not .synology) }}
export ARCHFLAGS="-arch {{ .chezmoi.arch }}"
# Setup aliases for gh cli.
# After executing the following commands to create the aliases, you can run
# `ghcs` and `ghce` instead of `gh copilot suggest` and `gh copilot explain`.
eval "$(gh copilot alias -- zsh)"

if [[ $(uname) = "Linux" ]]; then
  eval $(ssh-agent -s) &>/dev/null
  ssh-add {{ .chezmoi.homeDir }}/.ssh/id_ed25519 2>/dev/null
fi
{{ end }}

# Source any file with a *.zsh extension. They have additional settings.
for zsh_file ($ZDOTDIR/config/*.zsh) source $zsh_file
{{- if eq .osid "darwin" }}
for zsh_file ($ZDOTDIR/config/macos/*.zsh) source $zsh_file
{{ else if eq .osid "linux-ubuntu" }}
for zsh_file ($ZDOTDIR/config/ubuntu/*.zsh(N)) source $zsh
{{ end -}}
